//
//    FILE: AS5600_demo.ino
//  AUTHOR: Rob Tillaart
// PURPOSE: demo
//     URL: https://github.com/RobTillaart/AS5600
//
//  Examples may use AS5600 or AS5600L devices.
//  Check if your sensor matches the one used in the example.
//  Optionally adjust the code.


#include "AS5600.h"


//  Uncomment the line according to your sensor type
//AS5600L as5600;   //  use default Wire
 AS5600 as5600;   //  use default Wire
const float pi = 3.14159265;

const float throttleIN = 0;
const float pitchCTRL  = 1;
const float rollCTRL   = 2;
const float yawCTRL    = 3;

long lastRev = 0;
unsigned long lastT = 0;

void setup()
{
  
  Serial.begin(115200);
  Serial.println();
  Serial.println(__FILE__);
  Serial.print("AS5600_LIB_VERSION: ");
  Serial.println(AS5600_LIB_VERSION);
  Serial.println();

  Wire.begin();

  as5600.begin();  //  set direction pin.
  as5600.setDirection(AS5600_CLOCK_WISE);  //  default, just be explicit.
  int b = as5600.isConnected();
  Serial.print("Connect: ");
  Serial.println(b);
  delay(1000);
}


void loop()
{
  // Read full angle to force revolution update
  float angle = as5600.readAngle();   // MUST call this for rev counter to work

  long rev = as5600.getRevolutions();
  unsigned long t = millis();
  float dt = (t - lastT) / 1000.0;

  float dRev = rev - lastRev;

  float rpm = dRev * (60.0 / dt);

  Serial.print("Angle: ");
  Serial.println(angle);

  Serial.print("Revolutions: ");
  Serial.println(rev);

  Serial.print("RPM: ");
  Serial.println(rpm);

  lastRev = rev;
  lastT = t;

  delay(20);   // recommended sample rate (50 Hz)
}
  //// Calculate Output ////
 //
//   if (throttleIN > 20){
//     Duty = throttleIN + (pitchCTRL*cos(MotorRads)) + (rollCTRL * sin(MotorRads));
//   }
//   else{
//     Duty = 0;
//   }
//   if (throttleIN > 1000){
//     Duty = 0;
//   }
  
//   //// Output ////
//   throttleMAP = map(Duty,0,1000,4048,8096);
//   throttleOUT = constrain(throttleMAP, 4048, 8096);

//   analogWrite(4, throttleOUT);



//  -- END OF FILE --
